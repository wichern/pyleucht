
from dataclasses import dataclass

import pyleucht as pl

@dataclass
class Char:
    rows: tuple[int, int, int, int, int]  # 5 rows, 5 bits each
    width: int

    def is_set(self, p : pl.Point) -> bool:
        # Outside vertical bounds
        if p.y < 0 or p.y >= 5:
            return False

        # Outside horizontal bounds (glyph width)
        if p.x < 0 or p.x >= self.width:
            return False

        row = self.rows[p.y]

        # Bit position: MSB (bit 4) is x == 0
        bit = 4 - p.x

        return bool((row >> bit) & 1)

# Simple 5x5 font table for ASCII 0x21..0x7D (converted from font.h)
simple_ascii_table: list[Char] = [
    # 0x21 ('!')
    Char((
        0b10000,
        0b10000,
        0b10000,
        0b00000,
        0b10000,
    ), 1),

    # 0x22 ('"')
    Char((
        0b10100,
        0b10100,
        0b00000,
        0b00000,
        0b00000,
    ), 3),

    # 0x23 ('#')
    Char((
        0b01010,
        0b11111,
        0b01010,
        0b11111,
        0b01010,
    ), 5),

    # 0x24 ('$')
    Char((
        0b11100,
        0b11000,
        0b11100,
        0b01100,
        0b11100,
    ), 3),

    # 0x25 ('%')
    Char((
        0b10000,
        0b00100,
        0b01000,
        0b10000,
        0b00100,
    ), 3),

    # 0x26 ('&')
    Char((
        0b01100,
        0b10010,
        0b01100,
        0b10010,
        0b01110,
    ), 4),

    # 0x27 (''')
    Char((
        0b10000,
        0b10000,
        0b00000,
        0b00000,
        0b00000,
    ), 1),

    # 0x28 ('(')
    Char((
        0b01000,
        0b10000,
        0b10000,
        0b10000,
        0b01000,
    ), 2),

    # 0x29 (')')
    Char((
        0b10000,
        0b01000,
        0b01000,
        0b01000,
        0b10000,
    ), 2),

    # 0x2A ('*')
    Char((
        0b01000,
        0b10100,
        0b01000,
        0b00000,
        0b00000,
    ), 3),

    # 0x2B ('+')
    Char((
        0b00000,
        0b01000,
        0b11100,
        0b01000,
        0b00000,
    ), 3),

    # 0x2C (',')
    Char((
        0b00000,
        0b00000,
        0b00000,
        0b01000,
        0b11000,
    ), 2),

    # 0x2D ('-')
    Char((
        0b00000,
        0b00000,
        0b11100,
        0b00000,
        0b00000,
    ), 3),

    # 0x2E ('.')
    Char((
        0b00000,
        0b00000,
        0b00000,
        0b00000,
        0b10000,
    ), 1),

    # 0x2F ('/')
    Char((
        0b00100,
        0b01000,
        0b01000,
        0b01000,
        0b10000,
    ), 3),

    # 0x30 ('0')
    Char((
        0b11100,
        0b10100,
        0b10100,
        0b10100,
        0b11100,
    ), 3),

    # 0x31 ('1')
    Char((
        0b11000,
        0b01000,
        0b01000,
        0b01000,
        0b11100,
    ), 3),

    # 0x32 ('2')
    Char((
        0b11100,
        0b00100,
        0b11100,
        0b10000,
        0b11100,
    ), 3),

    # 0x33 ('3')
    Char((
        0b11100,
        0b00100,
        0b11100,
        0b00100,
        0b11100,
    ), 3),

    # 0x34 ('4')
    Char((
        0b10100,
        0b10100,
        0b11100,
        0b00100,
        0b00100,
    ), 3),

    # 0x35 ('5')
    Char((
        0b11100,
        0b10000,
        0b11100,
        0b00100,
        0b11100,
    ), 3),

    # 0x36 ('6')
    Char((
        0b11100,
        0b10000,
        0b11100,
        0b10100,
        0b11100,
    ), 3),

    # 0x37 ('7')
    Char((
        0b11100,
        0b00100,
        0b00100,
        0b00100,
        0b00100,
    ), 3),

    # 0x38 ('8')
    Char((
        0b11100,
        0b10100,
        0b11100,
        0b10100,
        0b11100,
    ), 3),

    # 0x39 ('9')
    Char((
        0b11100,
        0b10100,
        0b11100,
        0b00100,
        0b11100,
    ), 3),

    # 0x3A (':')
    Char((
        0b00000,
        0b10000,
        0b00000,
        0b10000,
        0b00000,
    ), 1),
    
    # 0x3B (';')
    Char((
        0b00000,
        0b10000,
        0b00000,
        0b10000,
        0b10000,
    ), 2),

    # 0x3C ('<')
    Char((
        0b00100,
        0b01000,
        0b10000,
        0b01000,
        0b00100,
    ), 3),

    # 0x3D ('=')
    Char((
        0b00000,
        0b11100,
        0b00000,
        0b11100,
        0b00000,
    ), 3),

    # 0x3E ('>')
    Char((
        0b10000,
        0b01000,
        0b00100,
        0b01000,
        0b10000,
    ), 3),

    # 0x3F ('?')
    Char((
        0b11100,
        0b00100,
        0b01100,
        0b00000,
        0b01000,
    ), 3),

    # 0x40 ('@')
    Char((
        0b11100,
        0b10100,
        0b10100,
        0b10000,
        0b11100,
    ), 3),

    # 0x41 ('A')
    Char((
        0b11100,
        0b10100,
        0b11100,
        0b10100,
        0b10100,
    ), 3),

    # 0x42 ('B')
    Char((
        0b11100,
        0b10100,
        0b11000,
        0b10100,
        0b11100,
    ), 3),

    # 0x43 ('C')
    Char((
        0b11100,
        0b10000,
        0b10000,
        0b10000,
        0b11100,
    ), 3),

    # 0x44 ('D')
    Char((
        0b11000,
        0b10100,
        0b10100,
        0b10100,
        0b11000,
    ), 3),

    # 0x45 ('E')
    Char((
        0b11100,
        0b10000,
        0b11100,
        0b10000,
        0b11100,
    ), 3),

    # 0x46 ('F')
    Char((
        0b11100,
        0b10000,
        0b11100,
        0b10000,
        0b10000,
    ), 3),

    # 0x47 ('G')
    Char((
        0b11100,
        0b10000,
        0b10100,
        0b10100,
        0b11100,
    ), 3),

    # 0x48 ('H')
    Char((
        0b10100,
        0b10100,
        0b11100,
        0b10100,
        0b10100,
    ), 3),

    # 0x49 ('I')
    Char((
        0b11100,
        0b01000,
        0b01000,
        0b01000,
        0b11100,
    ), 3),

    # 0x4A ('J')
    Char((
        0b00100,
        0b00100,
        0b00100,
        0b10100,
        0b11100,
    ), 3),

    # 0x4B ('K')
    Char((
        0b10100,
        0b10100,
        0b11000,
        0b10100,
        0b10100,
    ), 3),

    # 0x4C ('L')
    Char((
        0b10000,
        0b10000,
        0b10000,
        0b10000,
        0b11100,
    ), 3),

    # 0x4D ('M')
    Char((
        0b11111,
        0b10101,
        0b10101,
        0b10101,
        0b10101,
    ), 5),

    # 0x4E ('N')
    Char((
        0b11100,
        0b10100,
        0b10100,
        0b10100,
        0b10100,
    ), 3),

    # 0x4F ('O')
    Char((
        0b11100,
        0b10100,
        0b10100,
        0b10100,
        0b01000,
    ), 3),

    # 0x50 ('P')
    Char((
        0b11100,
        0b10100,
        0b11100,
        0b10000,
        0b10000,
    ), 3),

    # 0x51 ('Q')
    Char((
        0b11100,
        0b10100,
        0b10100,
        0b11100,
        0b01000,
    ), 3),

    # 0x52 ('R')
    Char((
        0b11100,
        0b10100,
        0b11000,
        0b10100,
        0b10100,
    ), 3),

    # 0x53 ('S')
    Char((
        0b11100,
        0b10000,
        0b11100,
        0b00100,
        0b11100,
    ), 3),

    # 0x54 ('T')
    Char((
        0b11100,
        0b01000,
        0b01000,
        0b01000,
        0b01000,
    ), 3),

    # 0x55 ('U')
    Char((
        0b10100,
        0b10100,
        0b10100,
        0b10100,
        0b11100,
    ), 3),

    # 0x56 ('V')
    Char((
        0b10100,
        0b10100,
        0b10100,
        0b10100,
        0b01000,
    ), 3),

    # 0x57 ('W')
    Char((
        0b10101,
        0b10101,
        0b10101,
        0b10101,
        0b11111,
    ), 5),

    # 0x58 ('X')
    Char((
        0b10100,
        0b10100,
        0b01000,
        0b10100,
        0b10100,
    ), 3),

    # 0x59 ('Y')
    Char((
        0b10100,
        0b10100,
        0b11100,
        0b01000,
        0b01000,
    ), 3),

    # 0x5A ('Z')
    Char((
        0b11100,
        0b00100,
        0b01000,
        0b10000,
        0b11100,
    ), 3),

    # 0x5B ('[')
    Char((
        0b11000,
        0b10000,
        0b10000,
        0b10000,
        0b11000,
    ), 2),

    # 0x5C ('\')
    Char((
        0b10000,
        0b01000,
        0b01000,
        0b01000,
        0b00100,
    ), 3),

    # 0x5D (']')
    Char((
        0b11000,
        0b01000,
        0b01000,
        0b01000,
        0b11000,
    ), 2),

    # 0x5E ('^')
    Char((
        0b01000,
        0b10100,
        0b00000,
        0b00000,
        0b00000,
    ), 3),

    # 0x5F ('_')
    Char((
        0b00000,
        0b00000,
        0b00000,
        0b00000,
        0b11100,
    ), 3),

    # 0x60 ('`')
    Char((
        0b10000,
        0b01000,
        0b00000,
        0b00000,
        0b00000,
    ), 2),

    # 0x61 ('a')
    Char((
        0b00000,
        0b01100,
        0b10100,
        0b10100,
        0b01100,
    ), 3),

    # 0x62 ('b')
    Char((
        0b10000,
        0b11000,
        0b10100,
        0b10100,
        0b11000,
    ), 3),

    # 0x63 ('c')
    Char((
        0b00000,
        0b11100,
        0b10000,
        0b10000,
        0b11100,
    ), 3),

    # 0x64 ('d')
    Char((
        0b00100,
        0b01100,
        0b10100,
        0b10100,
        0b01100,
    ), 3),

    # 0x65 ('e')
    Char((
        0b00000,
        0b01000,
        0b10100,
        0b11000,
        0b01100,
    ), 3),

    # 0x66 ('f')
    Char((
        0b01100,
        0b01000,
        0b11100,
        0b01000,
        0b01000,
    ), 3),

    # 0x67 ('g')
    Char((
        0b11100,
        0b10100,
        0b11100,
        0b00100,
        0b11000,
    ), 3),

    # 0x68 ('h')
    Char((
        0b10000,
        0b11000,
        0b10100,
        0b10100,
        0b10100,
    ), 3),

    # 0x69 ('i')
    Char((
        0b10000,
        0b00000,
        0b10000,
        0b10000,
        0b10000,
    ), 1),

    # 0x6A ('j')
    Char((
        0b01000,
        0b00000,
        0b01000,
        0b01000,
        0b10000,
    ), 2),

    # 0x6B ('k')
    Char((
        0b10000,
        0b10100,
        0b11000,
        0b10100,
        0b10100,
    ), 3),

    # 0x6C ('l')
    Char((
        0b11000,
        0b01000,
        0b01000,
        0b01000,
        0b01000,
    ), 2),

    # 0x6D ('m')
    Char((
        0b00000,
        0b11111,
        0b10101,
        0b10101,
        0b10101,
    ), 5),

    # 0x6E ('n')
    Char((
        0b00000,
        0b11100,
        0b10100,
        0b10100,
        0b10100,
    ), 3),

    # 0x6F ('o')
    Char((
        0b00000,
        0b11100,
        0b10100,
        0b10100,
        0b11100,
    ), 3),

    # 0x70 ('p')
    Char((
        0b11000,
        0b10100,
        0b10100,
        0b11000,
        0b10000,
    ), 3),

    # 0x71 ('q')
    Char((
        0b01100,
        0b10100,
        0b10100,
        0b01100,
        0b00100,
    ), 3),

    # 0x72 ('r')
    Char((
        0b00000,
        0b11100,
        0b10100,
        0b10000,
        0b10000,
    ), 3),

    # 0x73 ('s')
    Char((
        0b00000,
        0b01100,
        0b10000,
        0b00100,
        0b11000,
    ), 3),

    # 0x74 ('t')
    Char((
        0b01000,
        0b11100,
        0b01000,
        0b01000,
        0b01100,
    ), 3),

    # 0x75 ('u')
    Char((
        0b00000,
        0b10100,
        0b10100,
        0b10100,
        0b11100,
    ), 3),

    # 0x76 ('v')
    Char((
        0b00000,
        0b10100,
        0b10100,
        0b10100,
        0b01000,
    ), 3),

    # 0x77 ('w')
    Char((
        0b00000,
        0b10101,
        0b10101,
        0b10101,
        0b11111,
    ), 5),

    # 0x78 ('x')
    Char((
        0b00000,
        0b10100,
        0b01000,
        0b10100,
        0b10100,
    ), 3),

    # 0x79 ('y')
    Char((
        0b10100,
        0b10100,
        0b11100,
        0b00100,
        0b11000,
    ), 3),

    # 0x7A ('z')
    Char((
        0b00000,
        0b11100,
        0b00100,
        0b10000,
        0b01100,
    ), 3),

    # 0x7B ('{')
    Char((
        0b01100,
        0b01000,
        0b11000,
        0b01000,
        0b01100,
    ), 3),

    # 0x7C ('|')
    Char((
        0b10000,
        0b10000,
        0b10000,
        0b10000,
        0b10000,
    ), 1),

    # 0x7D ('}')
    Char((
        0b11000,
        0b01000,
        0b01100,
        0b01000,
        0b11000,
    ), 3),

	# 0x7E ('~')
    Char((
    	0b00000,
    	0b00000,
    	0b01101,
    	0b10110,
    	0b00000,
	), 5)
]

HEIGHT = 5
INVALID_CHAR = Char([[False]*5 for _ in range(HEIGHT)], 0)

def get_char(ch: str) -> Char:
    """Return Char for ASCII characters in range 0x21..0x7D, or None if unavailable."""
    if not ch:
        return INVALID_CHAR
    code = ord(ch[0])
    #print(f"Getting character for: {ch} (code {hex(code)})")
    if 0x21 <= code <= 0x7E:
        return simple_ascii_table[code - 0x21]
    return INVALID_CHAR
